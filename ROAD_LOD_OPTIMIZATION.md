# é“è·¯æ¸²æŸ“LODä¼˜åŒ–å®ç°

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

è§£å†³è°ƒè¯•åœ°å›¾ä¸­é“è·¯æ¸²æŸ“è¿‡äºç²¾ç»†å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œé€šè¿‡åŸºäºç¼©æ”¾æ¯”ä¾‹çš„LODï¼ˆLevel of Detailï¼‰ç³»ç»ŸåŠ¨æ€è°ƒæ•´æ¸²æŸ“ç²¾åº¦ã€‚

---

## ğŸ“Š LODçº§åˆ«è®¾è®¡

### åŸºäºå—/æ ¼æ¯”ä¾‹çš„åˆ†çº§ç­–ç•¥

| LODçº§åˆ« | å—/æ ¼èŒƒå›´ | é‡‡æ ·æ­¥é•¿ | æ¸²æŸ“ç²¾åº¦ | è¯´æ˜ |
|---------|----------|---------|---------|------|
| **FINEST** | < 50 | 1 | 100% | å…¨éƒ¨æ¸²æŸ“ï¼Œæœ€ç²¾ç»† |
| **SIXTY_FOURTH** | 50-500 | 64 | 1.56% | 1/64ç²¾åº¦ |
| **ONE_TWENTY_EIGHTH** | 500-1000 | 128 | 0.78% | 1/128ç²¾åº¦ |
| **TWO_FIFTY_SIXTH** | 1000-2000 | 256 | 0.39% | 1/256ç²¾åº¦ |
| **FIVE_TWELVE** | 2000-5000 | 512 | 0.195% | 1/512ç²¾åº¦ |
| **ONE_THOUSAND_TWENTY_FOURTH** | 5000-10000 | 1024 | 0.098% | 1/1024ç²¾åº¦ |
| **NONE** | > 15000 | âˆ | 0% | ä¸æ¸²æŸ“ |

### è®¡ç®—å…¬å¼

```java
// æ¯ä¸ªå±å¹•åƒç´ ä»£è¡¨å¤šå°‘ä¸–ç•Œæ–¹å—
blocksPerPixel = 1.0 / (baseScale * zoom)

// æ¯æ ¼ï¼ˆ80åƒç´ ï¼‰ä»£è¡¨å¤šå°‘æ–¹å—
blocksPerGrid = blocksPerPixel * 80
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. é…ç½®å¸¸é‡

```java
// é“è·¯æ¸²æŸ“LODé…ç½® - åŸºäºå—/æ ¼æ¯”ä¾‹
private static final double ROAD_LOD_FINEST = 200;      // æœ€ç²¾ç»†ï¼ˆå…¨éƒ¨æ¸²æŸ“ï¼‰
private static final double ROAD_LOD_QUARTER = 500;     // 1/4ç²¾åº¦
private static final double ROAD_LOD_EIGHTH = 1000;     // 1/8ç²¾åº¦
private static final double ROAD_LOD_SIXTEENTH = 2000;  // 1/16ç²¾åº¦
private static final double ROAD_LOD_THIRTYSECOND = 5000; // 1/32ç²¾åº¦
private static final double ROAD_LOD_NONE = 10000;      // ä¸æ¸²æŸ“
```

### 2. LODçº§åˆ«æšä¸¾

```java
private enum RoadLODLevel {
    FINEST,       // < 200å—/æ ¼ - å…¨éƒ¨æ¸²æŸ“ (æ­¥é•¿1)
    QUARTER,      // 200-500å—/æ ¼ - 1/4ç²¾åº¦ (æ­¥é•¿4)
    EIGHTH,       // 500-1000å—/æ ¼ - 1/8ç²¾åº¦ (æ­¥é•¿8)
    SIXTEENTH,    // 1000-2000å—/æ ¼ - 1/16ç²¾åº¦ (æ­¥é•¿16)
    THIRTYSECOND, // 2000-5000å—/æ ¼ - 1/32ç²¾åº¦ (æ­¥é•¿32)
    NONE          // > 10000å—/æ ¼ - ä¸æ¸²æŸ“
}
```

### 3. LODçº§åˆ«è®¡ç®—

```java
private RoadLODLevel getRoadLODLevel() {
    // è®¡ç®—å½“å‰ç¼©æ”¾ä¸‹ï¼Œæ¯ä¸ªå±å¹•åƒç´ ä»£è¡¨å¤šå°‘ä¸ªä¸–ç•Œæ–¹å—
    double blocksPerPixel = 1.0 / (baseScale * zoom);
    
    // è®¡ç®—æ¯æ ¼ï¼ˆå‡è®¾æ ¼å­é—´è·ä¸ºTARGET_GRID_PXåƒç´ ï¼‰ä»£è¡¨å¤šå°‘æ–¹å—
    double blocksPerGrid = blocksPerPixel * TARGET_GRID_PX;
    
    // æ ¹æ®å—/æ ¼æ¯”ä¾‹ç¡®å®šLODçº§åˆ«
    if (blocksPerGrid >= ROAD_LOD_NONE) return RoadLODLevel.NONE;
    if (blocksPerGrid >= ROAD_LOD_THIRTYSECOND) return RoadLODLevel.THIRTYSECOND;
    if (blocksPerGrid >= ROAD_LOD_SIXTEENTH) return RoadLODLevel.SIXTEENTH;
    if (blocksPerGrid >= ROAD_LOD_EIGHTH) return RoadLODLevel.EIGHTH;
    if (blocksPerGrid >= ROAD_LOD_QUARTER) return RoadLODLevel.QUARTER;
    return RoadLODLevel.FINEST;
}
```

### 4. é“è·¯æ¸²æŸ“ä¼˜åŒ–

```java
private void drawRoadPathWithRoadLOD(DrawContext ctx, 
                                     List<Records.RoadSegmentPlacement> segments, 
                                     int color, 
                                     RoadLODLevel roadLOD) {
    // æ ¹æ®é“è·¯LODçº§åˆ«å†³å®šé‡‡æ ·æ­¥é•¿
    int step = switch (roadLOD) {
        case FINEST -> 1;           // å…¨éƒ¨æ¸²æŸ“
        case QUARTER -> 4;          // 1/4ç²¾åº¦
        case EIGHTH -> 8;           // 1/8ç²¾åº¦
        case SIXTEENTH -> 16;       // 1/16ç²¾åº¦
        case THIRTYSECOND -> 32;    // 1/32ç²¾åº¦
        case NONE -> Integer.MAX_VALUE; // ä¸æ¸²æŸ“
    };
    
    if (step >= segments.size()) return; // æ­¥é•¿å¤ªå¤§ï¼Œè·³è¿‡
    
    ScreenPos prevPos = null;
    int drawnSegments = 0;
    int maxSegments = 10000; // é˜²æ­¢è¿‡åº¦æ¸²æŸ“
    
    for (int i = 0; i < segments.size() && drawnSegments < maxSegments; i += step) {
        BlockPos pos = segments.get(i).middlePos();
        ScreenPos currentPos = worldToScreen(pos.getX(), pos.getZ());
        
        // è¾¹ç•Œæ£€æŸ¥ä¼˜åŒ– - æ‰©å¤§è¾¹ç•Œä»¥é¿å…çº¿æ®µè¢«æˆªæ–­
        if (!isInUIBounds(currentPos.x, currentPos.y, 100)) {
            prevPos = currentPos;
            continue;
        }
        
        if (prevPos != null && i > 0) {
            if (isLineInUIBounds(prevPos.x, prevPos.y, currentPos.x, currentPos.y)) {
                drawLine(ctx, prevPos.x, prevPos.y, currentPos.x, currentPos.y, color);
                drawnSegments++;
            }
        }
        prevPos = currentPos;
    }
}
```

---

## ğŸš€ æ€§èƒ½æå‡

### æ¸²æŸ“è´Ÿè½½å¯¹æ¯”

å‡è®¾ä¸€æ¡é“è·¯æœ‰ **10,000 ä¸ªè·¯æ®µ**ï¼š

| ç¼©æ”¾çº§åˆ« | å—/æ ¼ | LODçº§åˆ« | æ¸²æŸ“è·¯æ®µæ•° | æ€§èƒ½æå‡ |
|---------|------|---------|-----------|---------|
| **æåº¦æ”¾å¤§** | 100 | FINEST | 10,000 | åŸºå‡† |
| **æ­£å¸¸æŸ¥çœ‹** | 300 | QUARTER | 2,500 | **4å€** âš¡ |
| **ä¸­ç­‰ç¼©å°** | 700 | EIGHTH | 1,250 | **8å€** âš¡âš¡ |
| **è¾ƒå°ç¼©å°** | 1,500 | SIXTEENTH | 625 | **16å€** âš¡âš¡âš¡ |
| **å¤§å¹…ç¼©å°** | 3,000 | THIRTYSECOND | 312 | **32å€** âš¡âš¡âš¡âš¡ |
| **æåº¦ç¼©å°** | 15,000 | NONE | 0 | **âˆ** ğŸš« |

### å®é™…åœºæ™¯åˆ†æ

**åœºæ™¯1: æŸ¥çœ‹æ•´ä¸ªé“è·¯ç½‘ç»œï¼ˆç¼©å°è§†å›¾ï¼‰**
- å—/æ ¼æ¯”ä¾‹: ~3000
- LODçº§åˆ«: THIRTYSECOND
- æ€§èƒ½æå‡: **32å€**
- ç”¨æˆ·ä½“éªŒ: ä»èƒ½çœ‹åˆ°é“è·¯è¿æ¥ï¼Œä½†ä¸ä¼šå¡é¡¿

**åœºæ™¯2: æŸ¥çœ‹å±€éƒ¨é“è·¯ç»†èŠ‚ï¼ˆæ”¾å¤§è§†å›¾ï¼‰**
- å—/æ ¼æ¯”ä¾‹: ~150
- LODçº§åˆ«: FINEST
- æ€§èƒ½æå‡: æ— ï¼ˆå…¨ç²¾åº¦ï¼‰
- ç”¨æˆ·ä½“éªŒ: å®Œæ•´ç»†èŠ‚ï¼Œæµç•…æ¸²æŸ“

**åœºæ™¯3: æåº¦ç¼©å°æŸ¥çœ‹å…¨å±€**
- å—/æ ¼æ¯”ä¾‹: >10000
- LODçº§åˆ«: NONE
- æ€§èƒ½æå‡: **å®Œå…¨è·³è¿‡**
- ç”¨æˆ·ä½“éªŒ: é“è·¯ä¸å¯è§ï¼Œä½†ç»“æ„èŠ‚ç‚¹æ¸…æ™°

---

## ğŸ¨ è§†è§‰æ•ˆæœ

### LODçº§åˆ«å¯è§†åŒ–

```
FINEST (æ­¥é•¿1):     â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—â”â—
                    å®Œæ•´è¿ç»­çš„é“è·¯çº¿

QUARTER (æ­¥é•¿4):    â—â”â”â”â—â”â”â”â—â”â”â”â—â”â”â”â—â”â”â”â—â”â”â”â—â”â”â”â—
                    ç•¥å¾®ç¨€ç–ï¼Œä½†ä»ç„¶è¿è´¯

EIGHTH (æ­¥é•¿8):     â—â”â”â”â”â”â”â—â”â”â”â”â”â”â—â”â”â”â”â”â”â—â”â”â”â”â”â”â—
                    æ˜æ˜¾ç¨€ç–ï¼Œä½†è·¯å¾„æ¸…æ™°

SIXTEENTH (æ­¥é•¿16): â—â”â”â”â”â”â”â”â”â”â”â”â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â—
                    éå¸¸ç¨€ç–ï¼Œä»…æ˜¾ç¤ºå¤§è‡´æ–¹å‘

THIRTYSECOND (æ­¥é•¿32): â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—
                       æåº¦ç¨€ç–ï¼Œä»…æ˜¾ç¤ºèµ·ç»ˆç‚¹è¿æ¥

NONE:               ï¼ˆä¸æ¸²æŸ“ï¼‰
```

---

## ğŸ” è°ƒè¯•ä¿¡æ¯

### å¦‚ä½•æŸ¥çœ‹å½“å‰LODçº§åˆ«

åœ¨ç»Ÿè®¡é¢æ¿ä¸­å¯ä»¥çœ‹åˆ°ï¼š
- **ç¼©æ”¾**: æ˜¾ç¤ºå½“å‰zoomå€¼
- æ ¹æ®zoomå’ŒbaseScaleå¯ä»¥æ¨ç®—å‡ºå—/æ ¼æ¯”ä¾‹

### è®¡ç®—ç¤ºä¾‹

```
å‡è®¾:
- baseScale = 0.05 (åœ°å›¾åˆå§‹ç¼©æ”¾)
- zoom = 2.0 (ç”¨æˆ·æ”¾å¤§2å€)
- TARGET_GRID_PX = 80 (æ ¼å­é—´è·)

è®¡ç®—:
blocksPerPixel = 1.0 / (0.05 * 2.0) = 10 å—/åƒç´ 
blocksPerGrid = 10 * 80 = 800 å—/æ ¼

ç»“æœ: LODçº§åˆ« = EIGHTH (1/8ç²¾åº¦)
```

---

## âš™ï¸ é…ç½®è°ƒæ•´

### å¦‚æœéœ€è¦è°ƒæ•´LODé˜ˆå€¼

ä¿®æ”¹ `RoadDebugScreen.java` ä¸­çš„å¸¸é‡ï¼š

```java
// æ›´æ¿€è¿›çš„LODç­–ç•¥ï¼ˆæ›´æ—©é™ä½ç²¾åº¦ï¼‰
private static final double ROAD_LOD_FINEST = 100;      // æ”¹ä¸º100
private static final double ROAD_LOD_QUARTER = 300;     // æ”¹ä¸º300
private static final double ROAD_LOD_EIGHTH = 600;      // æ”¹ä¸º600
// ...

// æ›´ä¿å®ˆçš„LODç­–ç•¥ï¼ˆä¿æŒæ›´é«˜ç²¾åº¦ï¼‰
private static final double ROAD_LOD_FINEST = 500;      // æ”¹ä¸º500
private static final double ROAD_LOD_QUARTER = 1000;    // æ”¹ä¸º1000
private static final double ROAD_LOD_EIGHTH = 2000;     // æ”¹ä¸º2000
// ...
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯

1. **å¤§é‡é“è·¯æµ‹è¯•**
   - ç”Ÿæˆ50+æ¡é“è·¯
   - ç¼©æ”¾åˆ°ä¸åŒçº§åˆ«
   - è§‚å¯Ÿå¸§ç‡å˜åŒ–

2. **æç«¯ç¼©æ”¾æµ‹è¯•**
   - æåº¦æ”¾å¤§ï¼ˆzoom > 5ï¼‰
   - æåº¦ç¼©å°ï¼ˆzoom < 0.1ï¼‰
   - éªŒè¯LODåˆ‡æ¢æµç•…æ€§

3. **è¾¹ç•Œæµ‹è¯•**
   - åœ¨LODåˆ‡æ¢ä¸´ç•Œç‚¹é™„è¿‘ç¼©æ”¾
   - éªŒè¯æ— æ˜æ˜¾è·³å˜

### æ€§èƒ½æŒ‡æ ‡

- **ç›®æ ‡å¸§ç‡**: 60 FPS
- **å¯æ¥å—å¸§ç‡**: 30 FPS
- **é“è·¯æ•°é‡**: æ”¯æŒ100+æ¡é“è·¯
- **è·¯æ®µæ•°é‡**: æ¯æ¡é“è·¯10,000+è·¯æ®µ

---

## ğŸ“ ä»£ç å˜æ›´æ€»ç»“

### ä¿®æ”¹çš„æ–‡ä»¶

- `src/main/java/net/countered/settlementroads/client/gui/RoadDebugScreen.java`

### æ–°å¢å†…å®¹

1. **å¸¸é‡é…ç½®** (6ä¸ª)
   - `ROAD_LOD_FINEST` ~ `ROAD_LOD_NONE`

2. **æšä¸¾ç±»å‹** (1ä¸ª)
   - `RoadLODLevel` (6ä¸ªçº§åˆ«)

3. **æ–¹æ³•** (2ä¸ª)
   - `getRoadLODLevel()`: è®¡ç®—å½“å‰LODçº§åˆ«
   - `drawRoadPathWithRoadLOD()`: åŸºäºLODæ¸²æŸ“é“è·¯

### ä¿®æ”¹å†…å®¹

1. **æ–¹æ³•æ›´æ–°** (1ä¸ª)
   - `drawRoadPathsLOD()`: é›†æˆé“è·¯LODç³»ç»Ÿ

---

## ğŸ‰ ä¼˜åŒ–æ•ˆæœ

### é¢„æœŸæ”¹è¿›

âœ… **æ€§èƒ½æå‡**: åœ¨ç¼©å°è§†å›¾ä¸‹æå‡ **8-32å€** æ¸²æŸ“æ€§èƒ½  
âœ… **å†…å­˜ä¼˜åŒ–**: å‡å°‘ç»˜åˆ¶è°ƒç”¨æ¬¡æ•°ï¼Œé™ä½GPUè´Ÿè½½  
âœ… **ç”¨æˆ·ä½“éªŒ**: æµç•…çš„ç¼©æ”¾æ“ä½œï¼Œæ— å¡é¡¿  
âœ… **è§†è§‰è´¨é‡**: åœ¨éœ€è¦ç»†èŠ‚æ—¶ä¿æŒå®Œæ•´ç²¾åº¦  
âœ… **å¯æ‰©å±•æ€§**: æ”¯æŒæ›´å¤šé“è·¯å’Œæ›´å¤§åœ°å›¾

### å…¼å®¹æ€§

- âœ… å‘åå…¼å®¹ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… é…ç½®çµæ´»ï¼šå¯è°ƒæ•´LODé˜ˆå€¼
- âœ… ç‹¬ç«‹ç³»ç»Ÿï¼šä¸å½±å“ç»“æ„èŠ‚ç‚¹å’Œè¿æ¥çº¿æ¸²æŸ“

---

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸ
- [ ] æ·»åŠ LODçº§åˆ«æŒ‡ç¤ºå™¨åˆ°UI
- [ ] å¹³æ»‘LODè¿‡æ¸¡ï¼ˆé¿å…çªå˜ï¼‰
- [ ] è‡ªé€‚åº”LODï¼ˆåŸºäºå¸§ç‡ï¼‰

### ä¸­æœŸ
- [ ] é“è·¯å®½åº¦LODï¼ˆè¿œè·ç¦»æ˜¾ç¤ºä¸ºå•çº¿ï¼‰
- [ ] é¢œè‰²LODï¼ˆè¿œè·ç¦»ç®€åŒ–é¢œè‰²ï¼‰
- [ ] æ‰¹é‡æ¸²æŸ“ä¼˜åŒ–

### é•¿æœŸ
- [ ] GPUåŠ é€Ÿæ¸²æŸ“
- [ ] é¢„è®¡ç®—LODå±‚çº§
- [ ] åŠ¨æ€LODé¢„æµ‹

---

**ç‰ˆæœ¬**: v2.0.4  
**æ—¥æœŸ**: 2025-10-03  
**ä¼˜åŒ–ç±»å‹**: æ€§èƒ½ä¼˜åŒ– - é“è·¯æ¸²æŸ“LODç³»ç»Ÿ  
**å½±å“èŒƒå›´**: è°ƒè¯•åœ°å›¾UI  
**æ€§èƒ½æå‡**: 8-32å€ï¼ˆå–å†³äºç¼©æ”¾çº§åˆ«ï¼‰
